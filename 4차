모각소 4차

활동 내용: 최종침투 및 플래그 탈취

목표: 웹 서버에서 flag 획득하기

처음 접속 시 /login 창이 보인다.
username과 password를 입력이 필요하나 가지고 있는 계정 정보가 없기 때문에 위회를 시도한다.

sql로 로그인 시스템을 구성할 경우 SELECT username, passwd FROM users WHERE username = '$input_user' AND passwd = '$input_pass'; 의 구조를 가진다
하지만 이렇게 하면 사용자의 입력이 그대로 들어가기에 마치 쿼리문처럼 동작하도록 하는 입력을 삽입할 수 있다.
또한 sql에서는 and가 or보다 높은 우선순위를 가져 A AND B OR C라고 한다면 (A AND B) OR C로 인식하기에 passwd에 'or'1'='1'을 입력하면 앞의 비교 조건을 무시하고 1=1을 비교하여 참이라고 판단하기에 로그인이 되게 된다.

로그인에 성공하면 /upload에 접근이 가능하게 되며, 파일 또한 업로드가 가능하다.
파일을 리턴할 경우 임의의 코드 실행이 가능하며, 초기 침투의 경우 쉘 획득을 위해 webshell을 php파일로 생성 후 업로드시
/uploads/filename의 경로에서 webshell을 실행할 수 있다.

이렇게 획득한 웹쉘로는 서버를 탐색할 수 있으며, ls -l을 통해 리눅스에 숨겨진 파일을 확인할 수 있고, .myfile을 살피면서 숨겨진 ssh id와 pw를 확인할 수 있다.

확인안 id와 pw로 서버에 접근 가능하며, .myfile을 읽어보면 linux-kernel이 필요하고 5.10 버전인 것을 알 수 있다.
5.10 버전에는 dirty-pipe 취약점이 존재하기 때문에 github에서 exploit 코드를 복사하여 compile하고, 실행하여 root 쉘 획득이 가능하다.
다시 ls -l을 이용하여 디렉토리에서 secret을 읽으면 플레그를 얻을 수 있다.
